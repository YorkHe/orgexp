.text 0x0000

// $s0 vga address
add $s0, $zero, $zero
lui $s0, 0xd000

// $s1 picture for Background
add $s1, $zero, $zero
addi $s1, $s1, 0x300

// $s2 picture for hero
add $s2, $zero, $zero
addi $s2, $s2, 0x700

// $s3 picture for plate
add $s3, $zero, $zero
addi $s3, $s3, 0x1200

// $s4 btn address
add $s4, $zero, $zero
lui $s4, 0xf000

// $s5 7-seg address
add $s5, $zero, $zero
lui $s5, 0xe000

// $s6 video buffer address
add $s6, $zero, $zero
lui $s6, 0xc000

// $s7 tmp_var
addi $s7, $zero, 0x1800

add $a0, $zero, $zero
add $a1, $zero, $zero

sw $a0, 0($s7)
sw $a1, 4($s7)
sw $a1, 8($s7)
sw $a1, 12($s7)

main:

  add $t0, $zero, $zero

//  time_count:
//    addi $t0, $t0, 1
//    slt $t1, $t0, $s3
//    bne $t1, $zero, time_count

//  jal clear_buf

  lw $t0, 0($s4)
  add $t1, $zero, $t0

//Read btn
  add $v0, $zero, $zero
  sw $t0, 0($s4)
  andi $t2, $t1, 0x100
  bne $t2, $zero, btn_right
  andi $t2, $t1, 0x200
  bne $t2, $zero, btn_left
  j btn_next

  btn_right:
    addi $v0, $zero, 1
    j btn_next

  btn_left:
    addi $v0, $zero, -1
    j btn_next

  btn_next:
    lw $a0, 0($s7)
    lw $a1, 4($s7)
    add $a0, $a0, $v0

  addi $t0, $zero, 120
  bne $a0, $t0, reset_cor
  add $a0, $zero, $zero
  add $a1, $zero, $zero

reset_cor:
  jal paint_hero

  sw $a0, 0($s7)
  sw $a1, 4($s7)

  lw $a0, 8($s7)
  lw $a1, 12($s7)
  addi $a0, $zero, 0x50
  addi $a1, $zero, 0x50
  jal paint_plate

  sw $a0, 8($s7)
  sw $a1, 12($s7)

  jal buf_to_vga

  j main



buf_to_vga:
  addi $t7, $zero, 19200
  add $t0, $zero, $zero

  buf_loop:
    add $t1, $t0, $t0
    add $t1, $t1, $t1
    add $t1, $t1, $s6
    lw $t2, 0($t1)
    add $t1, $t0, $t0
    add $t1, $t1, $t1
    add $t1, $t1, $s0
    sw $t2, 0($t1)
    addi $t0, $t0, 1
    slt $t3, $t0, $t7
    bne $t3, $zero, buf_loop
  jr $ra


clear_buf:
  addi $t7, $zero, 19200
  add $t0, $zero, $zero
  add $t1, $zero, $zero
  addi $t2, $zero, 0xc4
  clear_loop:
    add $t1, $t0, $t0
    add $t1, $t1, $t1
    add $t1, $t1, $s6
    sw $t2, 0($t1)
    addi $t0, $t0, 1
    slt $t3, $t0, $t7
    bne $t3, $zero, clear_loop
  jr $ra












paint_plate:

  add $t0, $zero, $zero
  add $t1, $zero, $zero

  beq $a1, $zero, plate_zero
plate_init:
  addi $t0, $t0, 160
  addi $a1, $a1, -1
  bne $a1, $zero, plate_init

plate_zero:
  add $t0, $t0, $a0

  add $t2, $zero, $zero
  add $t3, $zero, $zero
  add $t6, $zero, $zero
  add $t7, $zero, $zero

plate_loop:
  add $t4, $zero, $t2
  add $t4, $t4, $t4
  add $t4, $t4, $t4
  add $t4, $t4, $s3
  lw $t5, 0x0($t4)

  add $t4, $t0, $t0
  add $t4, $t4, $t4
  add $t4, $t4, $s6
  sw $t5, 0x0($t4)

plate_notdo:
  addi $t2, $t2, 1
  addi $t0, $t0, 1
  addi $t6, $t6, 1
  addi $t4, $zero, 25
  slt $t5, $t6, $t4
  beq $t5, $zero, plate_next_line

  j plate_loop

plate_next_line:
  add $t6, $zero, $zero
  addi $t7, $t7, 1

  addi $t4, $zero, 7
  slt $t5, $t7, $t4
  beq $t5, $zero, plate_done

  addi $t0, $t0, 160
  addi $t0, $t0, -25

  j plate_loop

plate_done:
  jr $ra

paint_hero:
  add $t0, $zero, $zero
  add $t1, $zero, $zero

  beq $a1, $zero, hero_zero
hero_init:
  addi $t0, $t0, 160
  addi $a1, $a1, -1
  bne $a1, $zero, hero_init

hero_zero:
  add $t0, $t0, $a0

  add $t2, $zero, $zero
  add $t3, $zero, $zero
  add $t6, $zero, $zero
  add $t7, $zero, $zero

hero_loop:
  add $t4, $zero, $t2
  add $t4, $t4, $t4
  add $t4, $t4, $t4
  add $t4, $t4, $s2
  lw $t5, 0x0($t4)

  add $t4, $t0, $t0
  add $t4, $t4, $t4
  add $t4, $t4, $s6
  sw $t5, 0x0($t4)

hero_notdo:
  addi $t2, $t2, 1
  addi $t0, $t0, 1
  addi $t6, $t6, 1
  addi $t4, $zero, 20
  slt $t5, $t6, $t4
  beq $t5, $zero, hero_next_line

  j hero_loop

hero_next_line:
  add $t6, $zero, $zero
  addi $t7, $t7, 1

  addi $t4, $zero, 20
  slt $t5, $t7, $t4
  beq $t5, $zero, hero_done

  addi $t0, $t0, 160
  addi $t0, $t0, -20

  j hero_loop

hero_done:
jr $ra


paint_bg:
// push

  add $t0, $zero, $zero
  add $t1, $zero, $zero
  add $t2, $zero, $zero
  add $t3, $zero, $zero
  add $t6, $zero, $zero
  add $t7, $zero, $zero
  add $a1, $zero, $zero
bg_loop:
// load pixel from memory
  add $t4, $zero, $t2
  add $t4, $t4, $t4
  add $t4, $t4, $t4
  add $t4, $t4, $s1
  lw $t5, 0x0($t4)

// save pixel to vram
  add $t4, $t0, $t0
  add $t4, $t4, $t4
  add $t4, $t4, $s6
  sw $t5, 0x0($t4)

  addi $t0, $t0, 0x1
  addi $t6, $t6, 0x1
  addi $t4, $zero, 160
  slt $t5, $t6, $t4
  beq $t5, $zero, bg_next_line1

bg_next_line1_ret:
  addi $t2, $t2, 0x1
  addi $t7, $t7, 0x1
  addi $t4, $zero, 15
  slt $t5, $t7, $t4
  beq $t5, $zero, bg_next_line2

bg_next_line2_ret:
  j bg_loop

bg_done:
  jr $ra


bg_next_line1:
  add $t6, $zero, $zero
  addi $a1, $a1, 15
  addi $t3, $t3, 1

  add $t2, $zero, $a1

  addi $t1, $t1, 0x1
  addi $t4, $zero, 120
  slt $t5, $t1, $t4
  beq $t5, $zero, bg_done

  addi $t4, $zero, 15
  slt $t5, $t3, $t4
  bne $t5, $zero, bg_line_next
  add $t3, $zero, $zero
  add $a1, $zero, $zero
  add $t2, $zero, $zero

bg_line_next:
  j bg_next_line1_ret


bg_next_line2:
  add $t2, $zero, $a1
  j bg_next_line2_ret







  // Background 15*15
.data 0x500
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xd6
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xd6,0xda,0xda,0xda,0xda,0xda,0xda,0xd6
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda,0xda,0xd6,0xda,0xda,0xda,0xda,0xda
 .word 0xd6,0xd6,0xda,0xda,0xda,0xda,0xda,0xda
 .word 0xda



  // Hero 20*20
.data 0x900
 .word 0xc4,0xc4,0xc4,0xc4,0xc4,0xc4,0xc4,0xc4
 .word 0xc4,0xc4,0xc4,0x88,0x0,0x0,0x64,0xc4
 .word 0xc4,0xc4,0xc4,0xc4,0xc0,0xc0,0xc0,0xc0
 .word 0xc0,0xc0,0xc0,0xc0,0xc0,0xa8,0x0,0x90
 .word 0xd9,0xb4,0x90,0x0,0xc4,0xc0,0xc0,0xc4
 .word 0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0
 .word 0xa8,0x24,0xfd,0xb5,0xb4,0xb4,0xb4,0xd9
 .word 0x48,0xa8,0xc0,0xc4,0xc0,0xc0,0xc0,0xc0
 .word 0xc0,0xc0,0xc0,0xc4,0x0,0xd8,0xb4,0xb4
 .word 0xb4,0xb4,0xb4,0xb4,0xd9,0x48,0xc4,0xc4
 .word 0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0x0
 .word 0xfd,0xb4,0xb4,0xb4,0xb5,0xb4,0xb4,0xb4
 .word 0xb4,0xfd,0x0,0xc4,0xc0,0xc0,0xc0,0xc0
 .word 0xc0,0xc0,0xc4,0x48,0xd9,0xb5,0xb4,0xb4
 .word 0xb4,0xb4,0xb4,0xb4,0xb4,0xb4,0x48,0xc4
 .word 0x64,0x20,0xc4,0xc0,0xc0,0xc8,0x0,0xfe
 .word 0x0,0xd9,0x0,0xb8,0xb4,0xb4,0xb4,0xb4
 .word 0xb4,0xb4,0xb4,0xa8,0x0,0xb4,0x0,0x0
 .word 0x0,0x6c,0xd9,0xb5,0xd8,0xb4,0xd8,0xb4
 .word 0xb4,0xb4,0xb4,0xb4,0xb4,0xb4,0xb4,0x84
 .word 0x48,0x6c,0x90,0xd9,0xb4,0xb4,0xb4,0xb4
 .word 0xb4,0xb4,0xb4,0xb4,0xb4,0xb5,0xb5,0xb4
 .word 0xb4,0xb4,0xb5,0x84,0x48,0x0,0x0,0x20
 .word 0x60,0x40,0x0,0xd8,0xb4,0xb4,0xb4,0xb4
 .word 0xb4,0xb4,0xb5,0xb4,0xb4,0xb4,0xb5,0xc4
 .word 0x20,0x88,0xc0,0xc0,0xc0,0xc0,0xa8,0x24
 .word 0xd9,0xd9,0xd9,0xb4,0xb4,0xd9,0xb4,0xd8
 .word 0xd8,0xd9,0x90,0xc4,0xc0,0xc0,0xc0,0xc0
 .word 0xc0,0xc0,0xc0,0x0,0x0,0x0,0x0,0x0
 .word 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xa8
 .word 0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0x24
 .word 0x95,0x74,0x74,0x74,0x74,0x74,0x75,0x74
 .word 0x74,0x74,0x0,0xc4,0xc0,0xc0,0xc0,0xc0
 .word 0xc0,0xc0,0xc4,0x0,0x0,0x0,0x0,0x0
 .word 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xc4
 .word 0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xa8,0x4d
 .word 0x74,0x74,0x75,0x74,0x74,0x74,0x74,0x75
 .word 0x75,0xbd,0x0,0xc4,0xc0,0xc0,0xc0,0xc0
 .word 0xc0,0xc0,0xa4,0x0,0x24,0x24,0x24,0x24
 .word 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xc4
 .word 0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xa8
 .word 0x0,0x64,0x20,0x0,0x0,0x0,0x0,0x0
 .word 0x0,0x0,0x0,0xc4,0xc0,0xc0,0xc0,0xc0
 .word 0xc0,0xc0,0xc0,0xc0,0x0,0xc0,0xc0,0x0
 .word 0xc0,0xc0,0x64,0xc0,0xa8,0xc0,0xc0,0xc4
 .word 0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xa8,0x0
 .word 0x0,0xc0,0xc0,0x0,0xc0,0xc0,0x0,0xc0
 .word 0xc0,0xa8,0xc0,0xc4,0xc4,0xc4,0xc4,0xc4
 .word 0xc4,0xc4,0xc4,0xc4,0xc4,0xc4,0x64,0xc4
 .word 0xc4,0x0,0xa8,0xa8,0x0,0xc4,0xc4,0xc4


  // Plate 25 * 7
.data 0x1300
 .word 0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0
 .word 0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0
 .word 0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0
 .word 0xc0,0xc0,0x50,0x78,0x74,0x74,0x74,0x54
 .word 0x74,0x54,0x74,0x74,0x74,0x74,0x70,0x74
 .word 0x74,0x74,0x74,0x74,0x78,0x54,0x28,0xc0
 .word 0xc0,0xc0,0x98,0x74,0x74,0x74,0x54,0x54
 .word 0x54,0x54,0x54,0x54,0x54,0x54,0x54,0x54
 .word 0x54,0x54,0x54,0x54,0x54,0x95,0x54,0x54
 .word 0x74,0xc0,0xc0,0x74,0x74,0xb5,0x74,0xb5
 .word 0x54,0x95,0x95,0x95,0x74,0x95,0x74,0x95
 .word 0x74,0x95,0x74,0x74,0x54,0x95,0x74,0x95
 .word 0x95,0x54,0x78,0xc0,0xc0,0x54,0x95,0xb5
 .word 0x74,0x95,0x74,0x74,0x74,0x54,0x54,0x54
 .word 0x54,0x54,0x54,0x54,0x54,0x54,0x74,0x74
 .word 0x74,0x74,0x95,0x50,0xc0,0xc0,0xc0,0x99
 .word 0x54,0x50,0x74,0x54,0x54,0x54,0x54,0x74
 .word 0x54,0x74,0x74,0x74,0x74,0x74,0x74,0x74
 .word 0x74,0x74,0x90,0x90,0xc0,0xc0,0xc0,0xc0
 .word 0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0
 .word 0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0
 .word 0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0


  .data 0x2000
